# Регулятор освещенности - решение задачи

В постановке задачи уже выдвигались требования к регулятору. После изучения задачи, теории по задаче, а также после изучения макета были сформулированы более конкретные требования.

Эти требования можно описать в виде следующей диаграммы:

![Требования к регулятору](/img/act-photo-problem-diagram.png)

Итак, требуется реализовать:

1. Два канала входного каскада для ввода сигнала с фотодиода $$x(t)$$ и сигнала опорного уровня $$r(t)$$, разность между которыми будет являться сигналом рассогласования $$e(t)$$ (см. [ПИД-регулятор](/theory/pid-controller.md)).
2. Выходной каскад для управления яркостью светодиода посредством ШИМ-сигнала (сигнала с широтно-импульсной модуляцией).
3. Алгоритм управления -- ПИД-регулятор.
4. Периферийные интерфейсы: `SPI`, `USART`, `I2C`.

После чего воплотить все это в виде печатной платы.

Будем рассматривать все по порядку.

## Входные каскады

Для включения фотодиода был выбран генераторный режим включения на базе преобразователя ток-напряжение на ОУ (рис.).

После получения доступа к макету было выяснено, что       вап

1. Воплощение в виде печатной платы
    * На базе микроконтроллера `ATmega8A`
    * С входами и выходами для:
        - Питания $$+12V$$
        - Преобразователя напряжения $$+12V \rightarrow \pm5V$$
        - Фотодиода (провод с макета)
        - Светодиода (провод с макета)
        - `USART`/`RS-232` -- отладка и обработка команд
        - `SPI` -- программирование памяти
        - `I2C` (потребуется для следующей задачи)
    * С защитой от переполюсовки питания
    * С кнопкой `RESET` для сброса микроконтроллера
    * С фильтро-усилительным входным каскадом, обеспечивающим:
        - Преобразование фототока фотодиода в напряжение
        - Фильтрацию сигнала с фотодиода -- отсечение частот, больших или равных 50Гц (наводки сети)
        - Усиление сигнала для заведения его на АЦП с диапазоном оцифровки 0..2.56В.
    * С входным каскадом установки опорного уровня освещенности, которую и необходимо поддерживать, обеспечивающим заведение сигнала опорного уровня на АЦП
2. 